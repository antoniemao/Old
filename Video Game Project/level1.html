<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 1: Mercury</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js" integrity="sha512-uaz5GpnQoE6t5echKlX8P52czvsIGgLPcvlzfvRubLZ1Hp8JemUDnbUiAahbVtPb+jUVrNETuXvAhDDF/N3M4w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script defer src="https://unpkg.com/p5.collide2d"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.js" integrity="sha512-TU9AWtV5uUZPX8dbBAH8NQF1tSdigPRRT82vllAQ1Ke28puiqLA6ZVKxtUGlgrH6yWFnkKy+sE6luNEGH9ar0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans&display=swap" rel="stylesheet">


    <!-- CSS -->
    <style>
        body {
            margin: 0px;
            padding: 0px;
            overflow: hidden;
        }

        
    </style>


</head>
<body>
    
    <script> 
        w = window.innerWidth
        h = window.innerHeight

        // ---


        // Character's values
        
        // Character's X and Y position
        var cX = (1/30 * w)
        var cY = (0.755 * h)
    
        // Character's width & height
        var cW = (0.02 * w)
        var cH = (0.075 * h)

        // ---
        

        // Gravity Value

        // If we're jumping or not
        var jump = false
        // Gravity
        var gravityValue = 0.9
        // Velocity/Player Speed
        var velocity = 5
        // How high you want to jump
        var lift = -13
        // Falling speed
        var fallSpeed = 5


        // ---
        

        // Track jumps
        var jumpTracker = 0 


        // ---


        // PLATFORM VALUES

        // Ground rectangle (starting platform)
        var sPX = 0
        var sPY = (0.83 * h)
        var sPW = (w)
        var sPH = (0.17 * h)

        // Platform 1
        var p1X = (1/10 * w)
        var p1Y = (0.7 * h)
        var p1W = (0.1 * w)
        var p1H = (0.017 * h)

        // Platform 2
        var p2X = (1/4.25 * w)
        var p2Y = (0.6 * h)
        var p2W = (0.1 * w)
        var p2H = (0.017 * h)

        // Platform 3 (Where the token will be & under platform 2)
        var p3X = (1/2.8 * w)
        var p3Y = (0.675 * h)
        var p3W = (0.08 * w)
        var p3H = (0.017 * h)

        // Platform 4
        var p4X = (1/2.5 * w)
        var p4Y = (0.5 * h)
        var p4W = (0.1 * w)
        var p4H = (0.017 * h)

        // Platform 4.1
        var p4_l1X = (1/4.25 * w)
        var p4_l1Y = (0.4 * h)
        var p4_l1W = (0.1 * w)
        var p4_l1H = (0.017 * h)

        // Platform 5
        var p5X = (1/1.75 * w)
        var p5Y = (0.5 * h)
        var p5W = (0.1 * w)
        var p5H = (0.017 * h)

        // Platform 5.1
        var p5_r1X = (1/1.4 * w)
        var p5_r1Y = (0.4 * h)
        var p5_r1W = (0.1 * w)
        var p5_r1H = (0.017 * h)

        // ---


        // TOKEN VALUES

        // Token 1
        var t1X = (1/2.35 * w)
        var t1Y = (0.65 * h)
        var t1D = (50)
        // Token 1's collision
        var hitToken1 = false
        var hitToken1Tracker = 0


        // TOKEN EFFECTS 
        // BUFFS

        // Array for the token effects 
        const tokenEffectsArr = ["controlDebuff","tpDebuff","jumpDebuff","nothing","controlBuff","jumpBuff"]

        // Switch their controls (If they press a, they move to the right. If they press d, they move to the left)
        var debuffControl = false


        // ---


        function gravity() {
            // Stop the character from falling down when it's at the ground and if they're not jumping
            if (cY + cH >= sPY && jump == false) {
                cY = cY
                // Reset the jump tracker when they hit the ground
                jumpTracker = 0
            }
            // Make the character fall down if it's not on the ground 
            else {
                cY = cY + (gravityValue * velocity)
            }
            // If the character pressed spacebar/jumped
            if (jump == true) {
                // Prevent the player from jumping above the screen
                if (cY <= 0 || jumpTracker >= -lift) {
                    // Stop the player from going below the ground when they're holding spacebar (GLITCH)
                    if (cY + cH >= sPY) {
                        cY = cY
                        velocity = 0
                    }
                    else {
                        velocity = fallSpeed 
                    }
                }
                // Allow the player to jump
                else {
                    velocity = lift
                    // Add 1 to the jump tracker
                    jumpTracker += 1
                }
            } 
            else {
                velocity = fallSpeed
            }
            // Prevent the character from leaving the screen
            if (cX <= 0) {
                cX = 0
            }
            if (cX + cW >= w) {
                cX = w - cW
            }
        }   

        function jumpUp() {
            if (keyIsDown(32)) {
                // If they press spacebar then change the jump value from false to true
                jump = true
            }
            // Set jump to false if they're not jumping 
            else {
                jump = false
            }
        }

        function moveLeft() {
            // If they don't have the control debuff, then move left when they press "a"
            if (debuffControl == false) {
                if (keyIsDown(65)) {
                    cX -= 5
                }
            }
            // If they do have the control debuff, then move left when they press "d"
            else {
               if (keyIsDown(68)) {
                cX -= 5
               } 
            }
        }

        function moveRight() {
            // If they don't have the control debuff, then move right when they press "d"
            if (debuffControl == false) {
                if (keyIsDown(68)) {
                    cX += 5
                }
            }
            // If they do have the control debuff, then move right when they press "a"
            else {
               if (keyIsDown(65)) {
                cX += 5
               }
            }
        }
        

        function setup() {
            createCanvas(w,h)
        }


        // ---

        
        // Ground/Platforms 


        // Ground
        function startingPlatform() {
            fill('rgba(78, 33, 33, 1)')
            rect(sPX,sPY,sPW,sPH)
        }

        // Platform #1
        function platform1() {
            fill('rgba(78, 33, 33, 1)')
            rect(p1X,p1Y,p1W,p1H)
        }

        // Platform #2 
        function platform2() {
            fill('rgba(78, 33, 33, 1)')
            rect(p2X,p2Y,p2W,p2H)
        } 

        // Platform #3 
        // NOTE: Platforms containing the token will be a different color 
        function platform3() {
            fill('yellow')
            rect(p3X,p3Y,p3W,p3H)
        }

        // Platform #4 
        function platform4() {
            fill('rgba(78, 33, 33, 1)')
            rect(p4X,p4Y,p4W,p4H)
        } 

        // Platform #4.1
        function platform4_l1() {
            fill('rgba(78, 33, 33, 1)')
            rect(p4_l1X,p4_l1Y,p4_l1W,p4_l1H)
        }

        // ---

        // Platform #5
        function platform5() {
            fill('rgba(77, 33, 33, 1)')
            rect(p5X,p5Y,p5W,p5H)
        }

        // Platform #5.1
        function platform5_r1() {
            fill('rgba(77, 33, 33, 1)')
            rect(p5_r1X,p5_r1Y,p5_r1W,p5_r1H)
        }


        // Tokens


        function token1() {
            hitToken1 = collideRectCircle(cX,cY,cW,cH,t1X,t1Y,t1D)
            if (hitToken1 == true) {
                // If the player collides with the token, then track the amount of times the player collides with the tokens. 
                hitToken1Tracker += 1
                // Make the token transparent/disappear
                fill('rgba(0,0,0,0)')
                noStroke()
                circle(t1X,t1Y,t1D)
                // Give them the effect ONLY one time 
                if (hitToken1Tracker == 1) {
                    // NOTE: Alert the user what effect they received when they collide with the token 


                    // Generate a random number to see which random effect they will receive
                    let randomTokenEffect = (Math.floor(Math.random() * (tokenEffectsArr.length)))
                    // Switch their "a" & "d" control
                    if (tokenEffectsArr[randomTokenEffect] == "controlDebuff") {
                        debuffControl = true
                    }
                    // TP the player back to the ground/start
                    else if (tokenEffectsArr[randomTokenEffect] == "tpDebuff") {
                        cX = w/30
                        cY = (0.65 * h)
                    }
                    // Decrease their jump power back to normal 
                    else if (tokenEffectsArr[randomTokenEffect] == "jumpDebuff") {
                        // If their jump power was increased before, then change it back to normal
                        if (lift == -17) {
                            lift = -13
                            window.alert("CHANGED")
                        }  
                        // If their jump power wasn't increased before, then nothing happens
                        else {
                            window.alert("NOTHING CHANGED")
                        }
                    }
                    // Nothing happens
                    else if (tokenEffectsArr[randomTokenEffect] == "nothing") {
                        window.alert('NOTHING')
                    }
                    // Change their controls back to normal 
                    else if (tokenEffectsArr[randomTokenEffect] == "controlBuff") {
                        // Check if their control was reversed previously 
                        if (debuffControl == true) {
                            debuffControl == false 
                            window.alert("CONTROL REVERSED")
                        }
                        // If their controls wasn't reversed before, then nothing happens
                        else {
                            window.alert("NO CONTROL")
                        }
                    }
                    // Increase their jump power
                    else if (tokenEffectsArr[randomTokenEffect] == "jumpBuff") {
                        lift = -15
                    }
                }
            }
            else if (hitToken1 == false && hitToken1Tracker == 0) {
                fill('yellow')
                noStroke()
                circle(t1X,t1Y,t1D)
            }
        }

        function draw() {
            clear()
            fill('red') 
            // Gravity
            jumpUp()
            gravity()

            // Moving left/right
            moveLeft()
            moveRight()

            // Player
            // circle(cX,cY,cD)
            rect(cX,cY,cW,cH)

            // Ground/starting platform
            startingPlatform()

            // Platform 1
            platform1() 

            // Token 1
            token1()

            // Prevent the player from falling down if they're on the platform (1).
            // This means: if the player's X coordinates is greater than or equal to the platform's left side (edge) AND less than or equal to the platform's right side (edge) AND the player's Y coordinates is greater than or equal to the platform's top then stop the player from falling through the platform.
            if ((p1X <= cX + cW) && (cX - cW <= p1X + p1W - cW) && (cY + cH >= p1Y) && (cY + cH <= p1Y + p1H) && jump == false) {
                // Make the character stay at the same height when they land on the platform
                cY = cY
                // Stop them from falling down
                velocity = 0
                // Reset jump tracker to let them jump when they land on the platform
                jumpTracker = 0
            }   

            // Platform 2
            platform2()

            // Prevent the player from falling down if they're on the platform (2).
            if ((p2X <= cX + cW) && (cX - cW <= p2X + p2W - cW) && (cY + cH >= p2Y) && (cY + cH <= p2Y + p2H) && jump == false) {
                // Make the character stay at the same height when they land on the platform
                cY = cY
                // Stop them from falling down
                velocity = 0
                // Reset jump tracker to let them jump when they land on the platform
                jumpTracker = 0
            }   

            // Platform 3
            platform3() 
            
            // Prevent the player from falling down if they're on the platform (3).
            if ((p3X <= cX + cW) && (cX - cW <= p3X + p3W - cW) && (cY + cH >= p3Y) && (cY + cH <= p3Y + p3H) && jump == false) {
                // Make the character stay at the same height when they land on the platform
                cY = cY
                // Stop them from falling down
                velocity = 0
                // Reset jump tracker to let them jump when they land on the platform
                jumpTracker = 0
            }   

            // Platform 4
            platform4() 

            // Prevent the player from falling down if they're on the platform (3).
            if ((p4X <= cX + cW) && (cX - cW <= p4X + p4W - cW) && (cY + cH >= p4Y) && (cY + cH <= p4Y + p4H) && jump == false) {
                // Make the character stay at the same height when they land on the platform
                cY = cY
                // Stop them from falling down
                velocity = 0
                // Reset jump tracker to let them jump when they land on the platform
                jumpTracker = 0
            }   

            // Platform 5 
            platform5()

            // Prevent the player from falling down if they're on the platform (3).
            if ((p5X <= cX + cW) && (cX - cW <= p5X + p5W - cW) && (cY + cH >= p5Y) && (cY + cH <= p5Y + p5H) && jump == false) {
                // Make the character stay at the same height when they land on the platform
                cY = cY
                // Stop them from falling down
                velocity = 0
                // Reset jump tracker to let them jump when they land on the platform
                jumpTracker = 0
            }   

            // NOTE: PLATFORM 4 and PLATFORM 5 are the 2 sides - where one side will have a decoy npc and the other will have the actual npc that the player needs to click on.
            // Platform 4 (Left side) will lead to the actual NPC 
            
            // Platform 4.1 
            platform4_l1() 
            
            // Prevent the player from falling down if they're on the platform (3).
            if ((p4_l1X <= cX + cW) && (cX - cW <= p4_l1X + p4_l1W - cW) && (cY + cH >= p4_l1Y) && (cY + cH <= p4_l1Y + p4_l1H) && jump == false) {
                // Make the character stay at the same height when they land on the platform
                cY = cY
                // Stop them from falling down
                velocity = 0
                // Reset jump tracker to let them jump when they land on the platform
                jumpTracker = 0
            }   

            // Platform 5 (Right side) will lead to the decoy NPC
            platform5_r1()

            // Prevent the player from falling down if they're on the platform (3).
            if ((p5_r1X <= cX + cW) && (cX - cW <= p5_r1X + p5_r1W - cW) && (cY + cH >= p5_r1Y) && (cY + cH <= p5_r1Y + p5_r1H) && jump == false) {
                // Make the character stay at the same height when they land on the platform
                cY = cY
                // Stop them from falling down
                velocity = 0
                // Reset jump tracker to let them jump when they land on the platform
                jumpTracker = 0
            }   

        }
    </script>
</body>
</html>